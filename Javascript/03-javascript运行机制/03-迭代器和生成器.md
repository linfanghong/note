# 迭代器
## 三个概念
- 可迭代对象 如Array、String、Set、Map等
- 迭代器对象 可迭代对象调用Symbol.iterator()方法后返回的对象，有next()方法
- 迭代结果对象 迭代器对象的next()方法返回的对象，有value和done属性
## 注意点
- 迭代器对象本身也是可迭代的，调用Symbol.iterator后返回的是其本身
- 迭代完成后，迭代器对象调用next()方法，始终返回{value: undefined, done: true}
## 迭代流程梳理
1. 调用可迭代对象的Symbol.iterator方法，返回一个迭代器对象
2. 每执行一次迭代，就执行一次迭代器对象的next()方法，得到一个迭代对象结果
3. 判断迭代对象结果的done是否为true，若为true，则已经完成了迭代，不能继续进行迭代了
4. 每一次迭代返回的迭代结果对象的value可用于其他计算
## 迭代流程代码展示
```
const arr = [1, 2, 3, 4, 5]
const iterator = arr[Symbol.iterator]()
for(let element = iterator.next(); element.done !== true; element=iterator.next()) {
  console.log(element.value)
}
```
## 可迭代对象的实现
- 自定义一个Range类，两个属性from和to，均为整数
- Range类可迭代，迭代为from到to的整数
- 代码实现
```
class Range {
  constructor(from, to){
    this.from = from
    this.to = to
  }
  [Symbol.iterator]() {
    let next = this.from
    let last = this.to
    return ({
      next() {
        if(next<=last){
          return {
            value: next++,
            done: false
          }
        }
        else{
          return {
            value: undefined,
            done: true
          }
        }
      },
      [Symbol.iterator]() {
        return this
      }
    })
  }
}
for(let el of new Range(1, 10)) {
    console.log(el)
}
// 1 2 ... 10
[...new Range(-2, 2)]
// [-2, -1, 0, 1, 2]
iter = (new Range(1, 10))[Symbol.iterator]()
iter.next(); // {value: 1, done: false}
[...iter[Symbol.iterator]()] // (9) [2, 3, 4, 5, 6, 7, 8, 9, 10]
```
- map函数返回一个可迭代对象
- 代码实现
```
function map(iterable, func){
  const iter = iterable[Symbol.iterator]()
  return {
    [Symbol.iterator]() {
      return {
        next() {
          let next = iter.next()
          if(next.done){
            return next
          }
          else {
            return {
              value: func(next.value),
              done: false
            }
          }
        },
        [Symbol.iterator](){
          return this
        }
      }
    }
  }
}
[...map([1, 2, 3, 4, 5], item => item+1)]
// (5) [2, 3, 4, 5, 6]
```
- filter函数返回符合条件的元素
- 代码实现
```
function filter(iterable, func) {
  const iter = iterable[Symbol.iterator]()
  return {
    next() {
      let next = iter.next()
      while(true){
        if(next.done){
          return next
        }
        else {
          if(func(next.value)){
            return next
          }
          else {
            next = iter.next()
          }
        }
      }
    },
    [Symbol.iterator](){
      return this
    }
  }
}
[...filter([1, 2, 3, 4, 5], item => item%2 === 0)]
// (2) [2, 4]
```